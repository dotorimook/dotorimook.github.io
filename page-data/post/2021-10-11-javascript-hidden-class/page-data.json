{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/post/2021-10-11-javascript-hidden-class/","result":{"data":{"site":{"siteMetadata":{"title":"dotorimook's blog","author":"Dotorimook"}},"markdownRemark":{"id":"b3c7145f-35db-5018-8123-ccfa8ea67722","excerpt":"Hidden class와 inline caching은 사소해보일 수도 있지만 javascript의 최적의 성능을 위해서 알아두면 좋은 개념인 것 같다. Hidden class javacript는 런타임에서 오브젝트의 속성을 추가/변경할 수 있는 동적인 언어이다. V8엔진은 hidden…","html":"<p>Hidden class와 inline caching은 사소해보일 수도 있지만 javascript의 최적의 성능을 위해서 알아두면 좋은 개념인 것 같다.</p>\n<h1>Hidden class</h1>\n<p>javacript는 런타임에서 오브젝트의 속성을 추가/변경할 수 있는 동적인 언어이다. V8엔진은 <strong>hidden class</strong>를 통해 색인 등 속성 관리를 최적화하고 있다.</p>\n<p>예를 들어 아래와 같은 코드가 있다고 할 때에</p>\n<deckgo-highlight-code language=\"jsx\"  >\n          <code slot=\"code\">function Point(x,y) {\n\tthis.x = x;\n\tthis.y = y;\n}\n\nvar obj = new Point(1,2);</code>\n        </deckgo-highlight-code>\n<p>객체가 생성되는 시점에 객체에 대한 <strong>hidden class</strong>가 생성되며, 새로운 속성이 객체에 추가될 때마다 새로운 <strong>hidden class</strong>가 생성되며 <strong>기존 hidden class에서 새로운 hidden class로의 전환</strong>이 일어난다:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/62d28471df5ba38dcb6ddf8d8cbbdefe/41d3c/img_hidden_class0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 490px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 27.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAoklEQVQY05WRzQrEIAyEff/nK7an4sFDaS2i/VfbWSbQhb3sbgNDAsbxi1EpJez7jpwzGNd1/a3zPBFjxDRNkkMIUMMwYBxHOOdA8ydBU5oZY6C1Rtu2UE3ToK5rVFUlpqUUof0l9nGyvu9F9Om6DmrbNkFdlgWkJTrreZ6/ij28Z639oFbHcQg6x6X501jX9V3zT4WQL/LgyUJu3ctg9t7jBTGE060IMYd4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/62d28471df5ba38dcb6ddf8d8cbbdefe/41d3c/img_hidden_class0.png\"\n        srcset=\"/static/62d28471df5ba38dcb6ddf8d8cbbdefe/12f09/img_hidden_class0.png 148w,\n/static/62d28471df5ba38dcb6ddf8d8cbbdefe/e4a3f/img_hidden_class0.png 295w,\n/static/62d28471df5ba38dcb6ddf8d8cbbdefe/41d3c/img_hidden_class0.png 490w\"\n        sizes=\"(max-width: 490px) 100vw, 490px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1635966d12a82affa90cd2172bc4c1b5/4ee7f/img_hidden_class1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 486px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJ0lEQVQoz5VSi26DMBDL/39Xf4FSTaMS0NKqQHmF8Ap4vmygruq07SSXNHC245wCy1qLeZ5liWVZ/oS1rygKGGMcyrKEyrIMyeWCKI6Rpin+U0IcBAGiKMLpdHI86sKf98MBb76PmKR106Druk1VIP/7vnfPFcMw4Ha7objfNwHZV0ZrWCrMdKq5FkzT5BrGcXQQsqqqNiFZT9xv+K0ASQKcz+iFsOPHRvCl/FOFYQifp/A8D3mefx6ZGWqasTRjmaWmmJIX4kiwhv0cvlyYhB8cjwhJ0LLR0uHStjDcb2lIIO7V2vQY9COpE6STjsdkyODNwdQ1LLPGU6+UejUOz8+JDvX1imW3w7zfQ3M8ZGRejZn6bSzcvJFQZqxlVg1vVSbhm+gK1gfv8L0x8s5z0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/1635966d12a82affa90cd2172bc4c1b5/4ee7f/img_hidden_class1.png\"\n        srcset=\"/static/1635966d12a82affa90cd2172bc4c1b5/12f09/img_hidden_class1.png 148w,\n/static/1635966d12a82affa90cd2172bc4c1b5/e4a3f/img_hidden_class1.png 295w,\n/static/1635966d12a82affa90cd2172bc4c1b5/4ee7f/img_hidden_class1.png 486w\"\n        sizes=\"(max-width: 486px) 100vw, 486px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bfc664bf9755402df8e7fbf68961da3c/bd48c/img_hidden_class2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 488px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABd0lEQVQoz4VSXW+CQBC8//+/2jfT+FJtWhQxgoAgcl/cKU7nLmqtbeImk8DBzc7OrDifz7DWQmuN0+mEUOHsGUINw4AkSbDebCKKooCoqwpJmmJBpMQ4jnhWV0JLwrauIbdbyLJE13UQfd+jZJfi6xMVPzRNE9VKKaGUuiGcBVzfnXNYr9fQSgKbFdDUsDwTxmjk8xZt2kNJDefdLxXX8vx5v99D0Z7DpdnA56b1SDOg2lGxNRDBN2UHSGMx8FIgOh6PcfQA730k1MZgPp8je58hJdp9C2M8skyhLNnkYNlEQlzk3BQFsjzP4zhZlkULrgE4WoJ0QTklpLbgcAzSs7HnPRdDFY/JhcOSQb1Np5jNZug5Xhy5oy1Zg48EKEqgbcNW/A1M3K9JKMcRHf0B1wC7HX2VYV56aFBUHq8vwHI5xtD+WzHxuAqOI1uuAiYTnFcrKK5CsCQo7w89e2iGI2MAP4QPCu8JPQklSQYqNFQog9on+3hf3/9PBxNm+ZHFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/bfc664bf9755402df8e7fbf68961da3c/bd48c/img_hidden_class2.png\"\n        srcset=\"/static/bfc664bf9755402df8e7fbf68961da3c/12f09/img_hidden_class2.png 148w,\n/static/bfc664bf9755402df8e7fbf68961da3c/e4a3f/img_hidden_class2.png 295w,\n/static/bfc664bf9755402df8e7fbf68961da3c/bd48c/img_hidden_class2.png 488w\"\n        sizes=\"(max-width: 488px) 100vw, 488px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>주의할 점은, 아래와 같은 코드가 있을 때:</p>\n<deckgo-highlight-code language=\"jsx\"  >\n          <code slot=\"code\">function Point(x,y) {\n\tthis.x = x;\n\tthis.y = y;\n}\n\nvar obj1 = new Point(1,2);\nvar obj2 = new Point(3,4);\n\nobj1.a = 5;\nobj1.b = 10;\n\nobj2.b = 10;\nobj2.a = 5;1  function Point(x,y) {\n\tthis.x = x;\n\tthis.y = y;\n}\n \nvar obj1 = new Point(1,2);\nvar obj2 = new Point(3,4);\n\nobj1.a = 5;\nobj1.b = 10;\n\nobj2.b = 10;\nobj2.a = 5;</code>\n        </deckgo-highlight-code>\n<p>처음 <code class=\"language-text\">obj1</code>와 <code class=\"language-text\">obj2</code>는 동일한 hidden class를 공유하지만, 속성을 추가하는 시점부터 hidden class가 달라진다고 한다:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a3707176ff6ce9d6c271f1868390de7f/d30ee/img_hidden_class3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 95.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB80lEQVQ4y6WUiY7iMBBE8/8fCGQgF+S+Lztxrlp3M6DZSDvDMpastkH9UtVt28CbY9s2jvMyI0wCeL6LQUkYb+KewGlRcD0XnutBjv1rQEp+AB7rr8CzbWqog3EaXlf4AOzHsi7oZIN+6Hj/3wqpTqSE4jQrrqEcBRpRfa/wXxarpkQYhkjTlEEE6WWPaZogtErjO8De5oYVYRrANE1cLhe0okZepziZJxyPR5R1AWNf8L3Fvu8RxzHKokTbNYizUCefYNkWKxRaneM6sCzrDtwrlFLyHIaBZ13XuN1uuF6vnFA0GfIyQ1HlXEc1jzoK7jYfG0oSQjCEYtd1SJIEWZahaRqul/mhLZ4vKMocSimsy4Z5XrAsK+ZpxiBHjIOCGicYBCmKAlVV8YyiiNU4jsOFp/1Zw8hSUVRI41wr9hEGkRYgGdI2HbvpOwGDlJEl27ZZFUGDIGBlZJf21ABX16mqdA2jjGvmeR66VqBv5VPAE0ggmmSXLI3j+Iz7kcQZDocDK26bHqIf4Pu+/oB7B34FEPynq9bUHaIwRpbm97qpCVLo/HFm+Evn8L7+vGq6Eeu6fcaV/1Nq1moFr409YH8mf7rP9FupmxUGCXf+168Nddnzrtykvyy//cBOK84fF9iWrc+j+v0DO+jG5GnFHaaa/gGc5MgS7DeBGgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/a3707176ff6ce9d6c271f1868390de7f/fcda8/img_hidden_class3.png\"\n        srcset=\"/static/a3707176ff6ce9d6c271f1868390de7f/12f09/img_hidden_class3.png 148w,\n/static/a3707176ff6ce9d6c271f1868390de7f/e4a3f/img_hidden_class3.png 295w,\n/static/a3707176ff6ce9d6c271f1868390de7f/fcda8/img_hidden_class3.png 590w,\n/static/a3707176ff6ce9d6c271f1868390de7f/efc66/img_hidden_class3.png 885w,\n/static/a3707176ff6ce9d6c271f1868390de7f/d30ee/img_hidden_class3.png 980w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1>Inline Caching</h1>\n<p>동적 타입 최적화를 위해 <strong>inline caching</strong>을 사용하고 있다. 이 기법은 <strong>동일한 메소드를 반복 호출할 때 동일한 유형의 객체에서 발생할 것이다</strong>라는 점을 기반으로 하고 있다.</p>\n<p>V8 엔진은 최근 호출된 메서드의 객체 타입을 캐싱해두고 있으면서 호출 속도를 높인다. 캐싱된 객체 타입이 일치한다면, 객체 속성에 직접 액세스하는 대신 캐싱되어있는 히든 클래스 정보를 사용하는 프로세스로 대신 수행할 수 있게 한다. </p>\n<p>만약 어떤 두 객체가 같은 hidden class를 공유한다면 실행속도가 크게 늘어날 수 있다. 또, hidden class의 변경이 없을 수록 캐싱의 효과가 좋다.</p>\n<h1>결론</h1>\n<p>Hidden class와 inline caching은  V8 엔진 기반 브라우저에서 최적의 퍼포먼스를 위해 알고 있으면 좋은 개념이다.</p>\n<p>좋은 퍼모먼스를 위해 다음을 지키면 좋을 것 같다:</p>\n<ol>\n<li>가능한 hidden class의 변경을 줄일 것</li>\n<li>가능한 hidden class 공유가 잘 되도록 할 것</li>\n</ol>\n<p>사실 typescript를 쓰거나 immutable한 코딩 습관을 가지고 있다면 자연스러운 일일 것 같다.</p>\n<h1>Reference</h1>\n<p><a href=\"https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html\">https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html</a></p>","frontmatter":{"title":"Javacript Hidden Class와 Inline Caching","date":"October 11, 2021","description":null}}},"pageContext":{"next":{"fields":{"slug":"/post/2021-10-14-auto-import-error/"},"frontmatter":{"title":"hoist-non-react-statics/node_modules/@types/react vscode auto import 문제"}},"previous":{"fields":{"slug":"/post/2021-10-11-keyboard-oring-review/"},"frontmatter":{"title":"기계식 키보드 소음 감소 오링 장착 후기"}},"slug":"/post/2021-10-11-javascript-hidden-class/"}},"staticQueryHashes":["2880150720","63159454"]}