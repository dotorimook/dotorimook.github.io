{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/post/2021-10-11-javascript-hidden-class/","result":{"data":{"site":{"siteMetadata":{"title":"dotorimook's blog","author":"Dotorimook"}},"markdownRemark":{"id":"b3c7145f-35db-5018-8123-ccfa8ea67722","excerpt":"Hidden class와 inline caching은 사소해보일 수도 있지만 javascript의 최적의 성능을 위해서 알아두면 좋은 개념인 것 같다. Hidden class javacript는 런타임에서 오브젝트의 속성을 추가/변경할 수 있는 동적인 언어이다. V8엔진은 hidden…","html":"<p>Hidden class와 inline caching은 사소해보일 수도 있지만 javascript의 최적의 성능을 위해서 알아두면 좋은 개념인 것 같다.</p>\n<h1>Hidden class</h1>\n<p>javacript는 런타임에서 오브젝트의 속성을 추가/변경할 수 있는 동적인 언어이다. V8엔진은 <strong>hidden class</strong>를 통해 색인 등 속성 관리를 최적화하고 있다.</p>\n<p>예를 들어 아래와 같은 코드가 있다고 할 때에</p>\n<deckgo-highlight-code language=\"jsx\"  >\n          <code slot=\"code\">function Point(x,y) {\n\tthis.x = x;\n\tthis.y = y;\n}\n\nvar obj = new Point(1,2);</code>\n        </deckgo-highlight-code>\n<p>객체가 생성되는 시점에 객체에 대한 <strong>hidden class</strong>가 생성되며, 새로운 속성이 객체에 추가될 때마다 새로운 <strong>hidden class</strong>가 생성되며 <strong>기존 hidden class에서 새로운 hidden class로의 전환</strong>이 일어난다:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/62d28471df5ba38dcb6ddf8d8cbbdefe/41d3c/img_hidden_class0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 490px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 27.7027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnklEQVR42p1RwQqEIBT0/z9POoR4EYLIEKIsTcnZHcFDl91tB54PnjIzzxF447ouNJRSfi5i2zZ47xFCqF1YazHPM6ZpqsOn2PcdxhhIKaGUguDR9z26rqukKSXknGv/VHxznifGccSyLNBag+YEh7RNd845rOuK4ziq8rfiisMw3BwLEvEPSfzPyhRvII+IMVYlXjwJpIVCpy0YbvcCp4nUJX4QyLgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/62d28471df5ba38dcb6ddf8d8cbbdefe/41d3c/img_hidden_class0.png\"\n        srcset=\"/static/62d28471df5ba38dcb6ddf8d8cbbdefe/12f09/img_hidden_class0.png 148w,\n/static/62d28471df5ba38dcb6ddf8d8cbbdefe/e4a3f/img_hidden_class0.png 295w,\n/static/62d28471df5ba38dcb6ddf8d8cbbdefe/41d3c/img_hidden_class0.png 490w\"\n        sizes=\"(max-width: 490px) 100vw, 490px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1635966d12a82affa90cd2172bc4c1b5/4ee7f/img_hidden_class1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 486px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVR42pWSC26DMBBEff9j5RANgUiN+ASSQPjZQAzOZBZUKUW0aldaeTH2+I29CgznHJ7Pp5Tz+JeUGMcRdV2j6zoYY1BVFdT9fkeWZTinKcqyxH9CQI7HI5IkQRiGSKmh4jiGfzjA2+8RRRHatsXj8cAwDN/yfU5qay1utxsESHgnimutoToK2NMJ9npF2zRomOvNYkkO6vt+rr/WlLTYUgSXC2gTRgRlUc+Nc7L+yZrQB0EwWyyKYpnnHRradYRxJG14qJILFnzJrYeRmKYJeZ7jw/PwSTey0XHOkUjTtiGIlhTCNc1aVMKSZKAIbx18ShhadvJN8nWorXZYj5Y0nYjtdoDvQ1NUCLfaTP3WFu/9VvGOzPkMTes1Ced/IrIsXJLxAgBSvQWd4BM5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/1635966d12a82affa90cd2172bc4c1b5/4ee7f/img_hidden_class1.png\"\n        srcset=\"/static/1635966d12a82affa90cd2172bc4c1b5/12f09/img_hidden_class1.png 148w,\n/static/1635966d12a82affa90cd2172bc4c1b5/e4a3f/img_hidden_class1.png 295w,\n/static/1635966d12a82affa90cd2172bc4c1b5/4ee7f/img_hidden_class1.png 486w\"\n        sizes=\"(max-width: 486px) 100vw, 486px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bfc664bf9755402df8e7fbf68961da3c/bd48c/img_hidden_class2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 488px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhElEQVR42o1SXVPCMBDM//9fvjk6ji9VGFqolBZKP9IkpB9k3USKoA96MzdpLs3e7l4EGMMw4HQ64Xw++y2cc3/mfC+OY6TbLT6yDLvdDqKqKqySBMkmRcx1Bv1PDOOIQ1GgyQvUTI8l2rZFkcTIlgvk7HI8HmG0hlLqLjVrxpiwau77vseWzKRsgV0KFBl6MhbGaORRiXJxhJI6SPfhmd5K9PKklNA870JD/ssGdW0JTLw9YK2FmKYJnbGQ2hLMegfhax7Qp//2YckoiiKs396RRG84lAeyHLFeK2RZT7k92SuIyxTgzl8XPUBBX4o8DyaXZRnqXo5hHat3uG0KFeQ7gg5sbKnABhVintgcnpUHfHx+xsvrK5qmCfWRXslNjmT9Ja+qNAHcr0GJ22cyT87SI5Ah6YUBOO4nq1GUAx4egOXCoW1VsOfncxIz8hWQkg0njacnyltB1TUcm0xk3jaSfTT7dMGvn2SuDG8BRz8kPqU+TWH3e8iuw70t7pK4Afw+/QSWCwcokvr7VgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/bfc664bf9755402df8e7fbf68961da3c/bd48c/img_hidden_class2.png\"\n        srcset=\"/static/bfc664bf9755402df8e7fbf68961da3c/12f09/img_hidden_class2.png 148w,\n/static/bfc664bf9755402df8e7fbf68961da3c/e4a3f/img_hidden_class2.png 295w,\n/static/bfc664bf9755402df8e7fbf68961da3c/bd48c/img_hidden_class2.png 488w\"\n        sizes=\"(max-width: 488px) 100vw, 488px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>주의할 점은, 아래와 같은 코드가 있을 때:</p>\n<deckgo-highlight-code language=\"jsx\"  >\n          <code slot=\"code\">function Point(x,y) {\n\tthis.x = x;\n\tthis.y = y;\n}\n\nvar obj1 = new Point(1,2);\nvar obj2 = new Point(3,4);\n\nobj1.a = 5;\nobj1.b = 10;\n\nobj2.b = 10;\nobj2.a = 5;1  function Point(x,y) {\n\tthis.x = x;\n\tthis.y = y;\n}\n \nvar obj1 = new Point(1,2);\nvar obj2 = new Point(3,4);\n\nobj1.a = 5;\nobj1.b = 10;\n\nobj2.b = 10;\nobj2.a = 5;</code>\n        </deckgo-highlight-code>\n<p>처음 <code class=\"language-text\">obj1</code>와 <code class=\"language-text\">obj2</code>는 동일한 hidden class를 공유하지만, 속성을 추가하는 시점부터 hidden class가 달라진다고 한다:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a3707176ff6ce9d6c271f1868390de7f/d30ee/img_hidden_class3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 95.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVR42q2UCW+jQAyF+f//L0mVcGcJhPsa5gDy1h6aVdQ2anezlqyBQf54z2Nw8I9xu93suqwz0muC6BxiUgLOq8B5MYjiCGEQQqjx58A7gNd7WuBq4IZHBJEPaaa/U3iHPMayLhhlb5PD+SnoDpN6giIlvOpZk+XZ9q4Tjd1zvrP08b7paiRJguyaQciR4BKDGGCMofsBzleAZxZvWJEWCY7HI07uCb1oUbUFDm8H7HY7lHWxAZ+p5BjHEWmaoiwrdEOHrExxOBzgei4pEtZuFIcIggB1W26WHwHTNNmUUtq16zqcz2fEcYy6qVD3JRVWZL2yPTPUR6kFzKIJTmPDhayCi4UQGIYBWZYhz3MLu1wum8XTyVpSSmOZV8xmoXXBTCknBSU1ND1zGFRV9Oa6RtM0FsBqfN+3UIa7rmstVmWN/FrR8zMdzAViJIXa0It7gpKwQWwK2ZLneSiKAm3bWij3ja9ZJcOjKETbUA/TAkEYIAxD9N2IsZ8QRzE83yPgu+WyLG2yXa31n1RKfZrJ/Fpiv99b1X03YBIKl4RdRZtCnh8uZADb/24u+36kNuTkhg5FKmuZoVrN1AL5+Ut5BHxMjnVdcVtpIhfKdds3Zia1wl47zwq/+m6f7dVVg+RXasEv/22Mnu2p86GNw/Qf/oc0k+7Jh+d6dh5fBiplaD5bO5Pc39+Dc8gt7l8ILAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"img\"\n        title=\"\"\n        src=\"/static/a3707176ff6ce9d6c271f1868390de7f/fcda8/img_hidden_class3.png\"\n        srcset=\"/static/a3707176ff6ce9d6c271f1868390de7f/12f09/img_hidden_class3.png 148w,\n/static/a3707176ff6ce9d6c271f1868390de7f/e4a3f/img_hidden_class3.png 295w,\n/static/a3707176ff6ce9d6c271f1868390de7f/fcda8/img_hidden_class3.png 590w,\n/static/a3707176ff6ce9d6c271f1868390de7f/efc66/img_hidden_class3.png 885w,\n/static/a3707176ff6ce9d6c271f1868390de7f/d30ee/img_hidden_class3.png 980w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1>Inline Caching</h1>\n<p>동적 타입 최적화를 위해 <strong>inline caching</strong>을 사용하고 있다. 이 기법은 <strong>동일한 메소드를 반복 호출할 때 동일한 유형의 객체에서 발생할 것이다</strong>라는 점을 기반으로 하고 있다.</p>\n<p>V8 엔진은 최근 호출된 메서드의 객체 타입을 캐싱해두고 있으면서 호출 속도를 높인다. 캐싱된 객체 타입이 일치한다면, 객체 속성에 직접 액세스하는 대신 캐싱되어있는 히든 클래스 정보를 사용하는 프로세스로 대신 수행할 수 있게 한다. </p>\n<p>만약 어떤 두 객체가 같은 hidden class를 공유한다면 실행속도가 크게 늘어날 수 있다. 또, hidden class의 변경이 없을 수록 캐싱의 효과가 좋다.</p>\n<h1>결론</h1>\n<p>Hidden class와 inline caching은  V8 엔진 기반 브라우저에서 최적의 퍼포먼스를 위해 알고 있으면 좋은 개념이다.</p>\n<p>좋은 퍼모먼스를 위해 다음을 지키면 좋을 것 같다:</p>\n<ol>\n<li>가능한 hidden class의 변경을 줄일 것</li>\n<li>가능한 hidden class 공유가 잘 되도록 할 것</li>\n</ol>\n<p>사실 typescript를 쓰거나 immutable한 코딩 습관을 가지고 있다면 자연스러운 일일 것 같다.</p>\n<h1>Reference</h1>\n<p><a href=\"https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html\">https://richardartoul.github.io/jekyll/update/2015/04/26/hidden-classes.html</a></p>","frontmatter":{"title":"Javacript Hidden Class와 Inline Caching","date":"October 11, 2021","description":null}}},"pageContext":{"next":{"fields":{"slug":"/post/2021-10-14-auto-import-error/"},"frontmatter":{"title":"hoist-non-react-statics/node_modules/@types/react vscode auto import 문제"}},"previous":{"fields":{"slug":"/post/2021-10-11-keyboard-oring-review/"},"frontmatter":{"title":"기계식 키보드 소음 감소 오링 장착 후기"}},"slug":"/post/2021-10-11-javascript-hidden-class/"}},"staticQueryHashes":["2880150720","63159454"]}